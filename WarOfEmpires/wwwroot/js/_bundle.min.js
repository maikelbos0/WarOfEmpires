function Grid(n,t){this.id=n;this.dataUrl=t;this.detailUrl=null;this.sortColumn=null;this.sortDescending=!1;this.searchFormId=null;let u=[],i=this,r=function(n){let t=$("#"+i.id),r=$("#"+i.searchFormId);$.ajax({method:"POST",url:i.dataUrl,data:{metaData:n,search:r.serializeArray().reduce(function(n,t){return n[t.name]=t.value,n},{})},success:function(n){n&&n.data&&n.metaData?t.datagridview(function(){this.populate(n.metaData,n.data)}):typeof n=="string"&&n.indexOf("Log in")>-1?window.location.reload():toastr.error("An error occurred loading data; please contact support to resolve this issue.")},error:function(){toastr.error("An error occurred loading data; please contact support to resolve this issue.")}})},f=function(n,t,r){i.detailUrl?n.append($("<a>",{title:t,href:i.detailUrl+"?id="+r.id}).text(t)):n.text(t).attr("title",t);r.IsRead===!1&&n.addClass("font-weight-bold")};this.addColumn=function(n,t,i,r,e){u.push({width:n,data:t,header:i,sortData:r,renderer:f,"class":{AlwaysVisible:null,HiddenFromSmall:"d-none d-md-block",HiddenFromMedium:"d-none d-lg-block",HiddenFromLarge:"d-none d-xl-block"}[e]})};this.initialize=function(){let n=$("#"+this.id),t=$("#"+this.searchFormId);n.datagridview({columns:u});t.on("submit",function(t){t.preventDefault();n.datagridview(function(){r(this.getMetaData())})});n.on("datagridview.sorted datagridview.paged",function(n,t){r(t)});r(new DataGridViewMetaData(this.sortColumn,this.sortDescending,0,25,0))}}toastr.options={positionClass:"toast-bottom-right",timeOut:3e3};$.fn.datagridview.defaults.getFooterPlugins=function(){return[$.fn.datagridview.footerPlugins.prevNext,$.fn.datagridview.footerPlugins.displayFull,$.fn.datagridview.footerPlugins.displayBasic]};let AjaxManager={onSuccess:[]};$(function(){function n(n){if(n.getResponseHeader("X-Unauthenticated"))return window.location.assign(window.location.href),!0}function t(n,t){let i=n.data("success-message"),r=n.find("#Command").val();r&&n.data("success-message-"+r)&&(i=n.data("success-message-"+r));t.getResponseHeader("X-IsValid")==="true"&&i&&toastr.success(i)}function i(n){n.getResponseHeader("X-Warnings")&&$.each(decodeURIComponent(n.getResponseHeader("X-Warnings")).split("|"),function(){toastr.warning(this)})}function r(n,t){n.html(t);let i=n.find("h2").text();i&&(document.title=i+" - War of Empires")}function u(){$.each(AjaxManager.onSuccess,function(n,t){t()})}$("body").on("submit","form:not(.html-only):not(.search-form)",function(){let f=$(this),e=f.closest("#main-content, .partial-content"),o=f.find('button[type="submit"]');return e.length===0?toastr.error("An error occurred locating content panel; please contact support to resolve this issue."):f.valid()&&(o.prop("disabled",!0),$.ajax({url:this.action,method:this.method,data:f.serialize(),success:function(o,s,h){n(h)||(t(f,h),i(h),r(e,o),u())},error:function(){toastr.error("An error occurred processing data; please try again.");o.prop("disabled",!1)}})),!1})});let BuildingTotalsManager={url:null,refresh:function(){let n=$("#empire-building-totals");n.length>0&&$.ajax({url:BuildingTotalsManager.url,cache:!1,success:function(t){n.html(t)},error:function(){toastr.error("An error occurred loading building totals; please refresh the page for accurate values.")}})}};$(function(){BuildingTotalsManager.refresh();AjaxManager.onSuccess.push(BuildingTotalsManager.refresh)});$(function(){$("body").on("click",'button[type="submit"]',function(){let n=$(this).closest("form").find("input#Command");n.length>0&&n.val($(this).val())})});let HousingTotalsManager={url:null,refresh:function(){let n=$("#empire-housing-totals");n.length>0&&$.ajax({url:HousingTotalsManager.url,cache:!1,success:function(t){n.html(t)},error:function(){toastr.error("An error occurred loading housing totals; please refresh the page for accurate values.")}})}};$(function(){HousingTotalsManager.refresh();AjaxManager.onSuccess.push(HousingTotalsManager.refresh)});$(function(){$("body").on("submit","form.html-only",function(){let n=$(this).find('button[type="submit"]');return $(this).valid()&&n.prop("disabled",!0),!0})});let NotificationManager={showNotifications:!1,url:null,refresh:function(){$("#empire-resources").length&&$.ajax({url:NotificationManager.url,method:"POST",success:function(n){$("#navbar-message-dropdown").toggleClass("notify",n.hasNewInvites||n.hasNewMessages);$("#invite-link").toggleClass("notify",n.hasNewInvites);$("#message-link").toggleClass("notify",n.hasNewMessages);$("#navbar-attack-dropdown, #attack-link").toggleClass("notify",n.hasNewAttacks);$("#navbar-market-dropdown, #market-link").toggleClass("notify",n.hasNewMarketSales);$("#navbar-empire-dropdown").toggleClass("notify",n.hasHousingShortage||n.hasUpkeepShortage||n.hasSoldierShortage);$("#empire-buildings-link").toggleClass("notify",n.hasHousingShortage);$("#worker-link").toggleClass("notify",n.hasUpkeepShortage);$("#troops-link").toggleClass("notify",n.hasSoldierShortage)},error:function(){toastr.error("An error occurred loading notitications; please refresh the page for accurate values.")}})}};$(function(){NotificationManager.refresh();AjaxManager.onSuccess.push(NotificationManager.refresh)});let PasswordStrength={get:function(n){if(n===null||n===undefined||n.toString().trim()==="")return 0;n=n.toString().trim();let t=0;return PasswordStrength.hasLowerCaseLetters(n)&&t++,PasswordStrength.hasUpperCaseLetters(n)&&t++,PasswordStrength.hasDigits(n)&&t++,PasswordStrength.hasSpecialCharacters(n)&&t++,n.length<6?Math.min(t,1):n.length<8?Math.min(t,2):n.length<10?Math.min(t,3):t},hasLowerCaseLetters:function(n){for(var t=0;t<n.length;t++){let i=n.charAt(t);if(i===i.toLowerCase()&&i!==i.toUpperCase())return!0}return!1},hasUpperCaseLetters:function(n){for(var t=0;t<n.length;t++){let i=n.charAt(t);if(i!==i.toLowerCase()&&i===i.toUpperCase())return!0}return!1},hasDigits:function(n){return/\d/.test(n)},hasSpecialCharacters:function(n){for(var t=0;t<n.length;t++){let i=n.charAt(t);if(i===i.toLowerCase()&&i===i.toUpperCase()&&!/\d/.test(i))return!0}return!1}};$(function(){$("input.password-strength").each(function(){let t=$(this),n=$("<div>",{"class":"small site-password-meter"}).hide();t.after(n);t.on("keyup",function(){switch(PasswordStrength.get(t.val())){case 0:n.hide();break;case 1:case 2:n.removeClass("site-password-meter-2 site-password-meter-3");n.text("Weak");n.addClass("site-password-meter-1");n.show();break;case 3:n.removeClass("site-password-meter-1 site-password-meter-3");n.text("Moderate");n.addClass("site-password-meter-2");n.show();break;case 4:n.removeClass("site-password-meter-1 site-password-meter-2");n.text("Strong");n.addClass("site-password-meter-3");n.show()}})})});let ResourceManager={url:null,refresh:function(){let n=$("#empire-resources");n.length>0&&$.ajax({url:ResourceManager.url,cache:!1,success:function(t){n.html(t)},error:function(){toastr.error("An error occurred loading resource values; please refresh the page for accurate values.")}})}};$(function(){ResourceManager.refresh();AjaxManager.onSuccess.push(ResourceManager.refresh)});$(function(){$(".partial-content").each(function(){var n=$(this),t=n.data("partial-url");t?$.ajax({url:t,method:"GET",cache:!1,success:function(t){n.html(t)},error:function(){toastr.error("An error occurred loading partial content; please refresh the page for accurate values.")}}):toastr.error("An error occurred determining content url; please contact support to resolve this issue.")})});